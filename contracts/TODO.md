# 结合会议记录与界面图的作业提示词（含合约细节+全流程要点）

本作业基于Web3大学课程项目，需覆盖会议提及的所有技术细节、业务逻辑与界面功能，涉及**4类核心合约**，结合The Graph实现链上数据查询，以下分模块明确作业要求：

### 一、整体作业框架（对应会议00:14-02:03核心定位）

参考界面图（网页端课程列表+移动端作者平台），基于Web2+Web3技术完成全流程开发，需满足：

1. 核心目标：搭建Web3大学项目雏形，最终需将作业拼接成完整项目，未完成作业会导致线下课无法跟进
2. 技术协同：Web2存储课程详情（标题/内容/视频），Web3存储核心交易数据（课程ID/购买状态），通过The Graph实现链上数据索引查询
3. 涉及合约：**课程合约、Lue币（ERC20）合约、兑换合约、AAVE质押合约**（共4类），需明确各合约交互逻辑

### 二、课程合约相关开发（会议02:03-12:21+界面图课程列表/详情）

#### 1. 课程数据存储与创建（对应界面图移动端“课程创建001/002”）

- 链上存储：通过课程合约的`Mapping`结构记录核心数据，格式为`mapping(课程ID => mapping(用户地址 => bool))`（课程ID为Web2生成的UUID，用户地址对应购买状态）
- 创建流程：
  1. Web2端：填写课程标题/内容（禁止用AI糊弄，需人工完善）、设置价格（仅支持“Lue币”单位，如10个Lue币），存储至数据库并生成UUID
  2. Web3端：调用课程合约，将UUID（课程ID）与创建者地址写入`Mapping`（首次创建需将创建者标记为`true`，确保创建者可查看课程）
  3. ⚠️ 会议强调：需先保证Web2创建成功，再调用合约，避免“Web2成功+Web3失败”导致数据丢失；创建课程需消耗Gas（因修改链上`Mapping`）
- The Graph使用：在界面图网页端“课程列表”加载、移动端“已创建课程查询”时，通过The Graph索引课程合约的`Mapping`数据，实现“链上课程ID+Web2详情”的协同展示

#### 2. 课程详情访问控制（对应界面图网页端“课程详情”按钮）

- 核心逻辑：点击详情时，需验证用户是否已购买（仅`NODE`端判断有效，前端`GS`判断可被绕过路由）
  1. 前端传递用户钱包地址至`NODE`端
  2. `NODE`端通过The Graph查询课程合约的`Mapping`，确认该地址是否为`true`（已购买）
  3. 已购买：返回Web2存储的课程详情（视频/文档）；未购买：`redirect`至无权限页面
- ⚠️ 会议提醒：当前可暂不实现钱包地址鉴权（后续补充引擎验证码），但需预留接口，避免地址伪造

### 三、Lue币（ERC20）合约相关开发（会议02:49-07:29+界面图“兑换Lue币”）

#### 1. Lue币基础功能（会议06:01-06:36）

- 合约类型：遵循ERC20标准，用于课程购买唯一指定代币（或自定义其他ERC20代币，需在合约中明确）
- 核心操作：购买课程前需通过`approve`授权（会议类比“银行每日交易限额”），授权逻辑由Lue币合约实现，代码片段参考：

  ```solidity
  // Lue币合约approve方法（简化）
  function approve(address spender, uint256 amount) external returns (bool) {
      allowance[msg.sender][spender] = amount; // 授权合约可操作的最大Lue币数量
      emit Approval(msg.sender, spender, amount);
      return true;
  }
  ```

- ⚠️ 会议风险提示：市场存在假`UIDT`代币，需在界面图“兑换Lue币”区域添加代币真实性校验逻辑

#### 2. Lue币兑换（对应界面图“兑换Lue币/确认兑换”）

- 兑换比例：会议明确暂按`17ETH = 4000个Lue币`执行，需在界面添加“数量输入框+确认兑换”按钮
- 交互逻辑：用户用ETH兑换Lue币时，需调用Lue币合约的`transferFrom`方法，从兑换池（合约指定地址）转移Lue币至用户地址
- The Graph使用：在界面图“兑换记录”展示时，通过The Graph索引Lue币合约的`Transfer`事件，获取用户兑换历史

### 四、兑换合约相关开发（会议14:07-16:28+界面图作者平台“Lue兑USDT”）

#### 1. 核心功能（会议14:11-15:19）

- 合约作用：实现`Lue币↔ETH`、`Lue币↔USDT`兑换，平台从中收取手续费（合约中需设置手续费比例）
- 流转逻辑：
  1. Lue币兑ETH：用户将Lue币转入兑换合约→合约验证余额→合约将对应ETH转给用户（ETH需提前存入合约储备池）
  2. Lue币兑USDT（界面图作者平台）：流程同上，需在合约中关联USDT合约地址
- 会议强调：兑换时需先调用Lue币合约的`approve`，授权兑换合约操作用户Lue币，再执行兑换

#### 2. 数据查询（会议16:00-16:10）

- The Graph使用：在界面图“兑换历史”“手续费明细”展示时，通过The Graph索引兑换合约的`Exchange`事件，获取兑换金额、手续费、时间戳等数据

### 五、AAVE质押合约相关开发（会议21:33-24:15+界面图“质押系统”）

#### 1. 质押流程（会议22:54-24:05）

- 合约交互：调用AAVE V3合约（会议提供文档方向：`aave V3 contract`），核心使用`supply`方法存入资产（ETH/USDT），获取年化5%收益，代码片段参考：

  ```javascript
  // 前端调用AAVE合约supply方法（会议示例）
  const aaveContract = new ethers.Contract(AAVE_V3_ADDRESS, AAVE_V3_ABI, signer);
  const supplyTx = await aaveContract.supply(
    USDT_ADDRESS, // 质押资产合约地址（ETH/USDT）
    ethers.utils.parseUnits("100", 18), // 质押数量（100 USDT）
    userAddress, // 用户地址
    0 // referralCode（会议说明默认填0）
  );
  await supplyTx.wait(); // 等待交易确认，获取aUSDT（质押凭证）
  ```

- 钱包交互：会议明确质押时钱包会弹3次（1次Gas支付、1次合约确认、1次合约转质押凭证），需在界面图“质押系统”区域添加交互状态提示

#### 2. 数据查询（会议22:06-22:13）

- The Graph使用：在界面图“质押资产/收益明细”展示时，通过The Graph索引AAVE合约的`Supply`事件，获取用户质押金额、收益累计数据
- ⚠️ 会议说明：此模块为选修，但线下课需强制完成，需在界面标注“选修”标识

### 六、作者平台功能（对应界面图移动端“Web3大学-作者平台”+会议13:26-19:03）

#### 1. 课程管理（会议16:04-17:14）

- 功能要求：展示作者已创建课程（如“课程创建001”），需同时显示Web2数据（标题/内容）与Web3数据（课程ID/购买人数，来自课程合约`Mapping`）
- The Graph使用：通过The Graph索引课程合约的`CourseCreated`事件，获取作者创建的所有课程ID，再匹配Web2数据库详情

#### 2. AI润色（会议16:44-17:00）

- 会议要求：在“课程创建”区域添加“AI润色”按钮，调用前期作业的AI接口（如Worker接口）优化课程标题/内容，需避免直接使用AI生成全部内容
- 数据存储：润色后的内容仍存储至Web2数据库，不写入链上

### 七、关键避坑指南（会议高频强调点）

1. 合约权限：会议33:07-33:41明确“仅owner可创建课程”，需在课程合约中添加`onlyOwner`修饰符，避免恶意创建（简化版可暂开放，后续需补全）
2. 数据同步：Web2与Web3操作需为“原子性”，如课程创建需“Web2成功→Web3调用”，失败需重试（会议20:01-20:16）
3. 链上数据修改：课程合约`Mapping`可修改（如退费改`false`），但会议31:07明确“购买后不退费”，需在合约中禁用退费逻辑
4. 跨链提示：会议29:42强调“无跨链操作”，所有合约交互均在以太坊测试网执行，需在界面标注测试网环境

### 八、The Graph全场景使用清单（对应会议08:21-08:56）

| 功能模块         | The Graph索引内容                  | 界面应用场景                  |
|------------------|-----------------------------------|-----------------------------|
| 课程合约         | `Mapping`（课程ID-用户购买状态）、`CourseCreated`事件 | 课程列表加载、详情权限判断    |
| Lue币合约         | `Transfer`事件、`Approval`事件     | 兑换历史、授权状态验证        |
| 兑换合约         | `Exchange`事件、手续费记录         | 兑换明细、平台收益统计        |
| AAVE质押合约     | `Supply`事件、`Withdraw`事件       | 质押资产展示、收益计算        |

### 九、作业验收核心标准（会议00:40-01:02+31:45）

1. 功能完整性：课程创建/购买、Lue币兑换、质押（选修）全流程可跑通，界面图所有按钮均有对应逻辑
2. 数据一致性：Web2与Web3数据同步无偏差，链上数据可通过The Graph正确索引
3. 合约安全性：`approve`授权、owner权限、代币校验逻辑无漏洞
4. 会议特殊要求：禁止用AI生成课程内容，需人工完善；线下课需补全鉴权、质押等选修模块
